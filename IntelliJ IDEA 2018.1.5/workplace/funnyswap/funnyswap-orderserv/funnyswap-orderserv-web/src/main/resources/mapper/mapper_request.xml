<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.funnyswap.dao.RequestDao">
    <resultMap id="BaseResultMap" type="com.funnyswap.domain.Request">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="order_id" property="orderId" jdbcType="VARCHAR"/>
        <result column="member_a_id" property="memberAId" jdbcType="VARCHAR"/>
        <result column="item_a_id" property="itemAId" jdbcType="VARCHAR"/>
        <result column="member_b_id" property="memberBId" jdbcType="VARCHAR"/>
        <result column="item_b_id" property="itemBId" jdbcType="VARCHAR"/>
        <result column="request_status" property="requestStatus" jdbcType="INTEGER"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="add_time" property="requestTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="del_flag" property="delFlag" jdbcType="INTEGER"/>
    </resultMap>
    <sql id="Base_Column_List">
    id,order_id,member_a_id,item_a_id,member_b_id,item_b_id,request_status,remark,add_time,update_time,del_flag
    </sql>

    <select id="selectRequest" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM request
        <where>
            <if test="id != null">
                id = #{id}
            </if>
            <if test="orderId != null">
                AND order_id = #{orderId}
            </if>
            <if test="memberAId != null">
                AND member_a_id = #{memberAId}
            </if>
            <if test="itemAId != null">
                AND item_a_id = #{itemAId}
            </if>
            <if test="memberBId != null">
                AND member_b_id = #{memberBId}
            </if>
            <if test="itemBId != null">
                AND item_b_id = #{itemBId}
            </if>
            <if test="requestStatus != null">
                AND request_status = #{requestStatus}
            </if>
            <if test="remark != null">
                AND remark = #{remark}
            </if>
            <if test="requestTime != null">
                AND add_time = #{requestTime}
            </if>
            <if test="updateTime != null">
                AND update_time = #{updateTime}
            </if>
            AND del_flag = 0
        </where>
    </select>

    <select id="selectRequestFuzzy" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM request
        <where>
            <if test="memberAId != null">
                (member_a_id = #{memberAId} or member_b_id = #{memberAId})
            </if>
            <if test="itemAId != null">
                AND (item_a_id = #{itemAId } or item_b_id = #{itemAId} )
            </if>
                AND request_status = 0
                AND del_flag = 0
        </where>
    </select>

    <insert id="insertRequest" >
        insert into request
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id ,
            </if>
            <if test="orderId != null">
                order_id ,
            </if>
            <if test="memberAId != null">
                member_a_id ,
            </if>
            <if test="itemAId != null">
                item_a_id ,
            </if>
            <if test="memberBId != null">
                member_b_id ,
            </if>
            <if test="itemBId != null">
                item_b_id ,
            </if>
            <if test="requestStatus != null">
                request_status ,
            </if>
            <if test="remark != null">
                remark ,
            </if>
                add_time ,
                update_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="orderId != null">
                #{orderId,jdbcType=VARCHAR},
            </if>
            <if test="memberAId != null">
                #{memberAId,jdbcType=VARCHAR},
            </if>
            <if test="itemAId != null">
                #{itemAId,jdbcType=VARCHAR},
            </if>
            <if test="memberBId != null">
                #{memberBId,jdbcType=VARCHAR},
            </if>
            <if test="itemBId != null">
                #{itemBId ,jdbcType=VARCHAR},
            </if>
            <if test="requestStatus != null">
                #{requestStatus,jdbcType=INTEGER},
            </if>
            <if test="remark != null">
                #{remark,jdbcType=VARCHAR},
            </if>
                now() ,
                now()
        </trim>
    </insert>


    <update id="updateRequest" >
        update request
        <set>
            <if test="memberAId != null">
                member_a_id = #{memberAId,jdbcType=VARCHAR},
            </if>
            <if test="itemAId != null">
                item_a_id = #{itemAId,jdbcType=VARCHAR},
            </if>
            <if test="memberBId != null">
                member_b_id = #{memberBId,jdbcType=VARCHAR},
            </if>
            <if test="itemBId != null">
                item_b_id = #{itemBId,jdbcType=VARCHAR},
            </if>
            <if test="requestStatus != null">
                request_status = #{requestStatus,jdbcType=INTEGER},
            </if>
            <if test="remark != null">
                remark = #{remark,jdbcType=VARCHAR},
            </if>
            <if test="delFlag != null">
                del_flag = #{delFlag,jdbcType=INTEGER}
            </if>
        </set>
        where order_id = #{orderId,jdbcType=VARCHAR}
    </update>
</mapper>